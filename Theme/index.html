<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" content="initial-scale=1.0", user-scalable=no">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="assets/ico/favicon.ico">

    <title>Roofly</title>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">

     <!-- The Maps Styling -->
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" />
    <style type="text/css">
	    	
	    	#mapDiv { height: 600px; width: 100% }
	    	#mapDiv45 { height: 400px; width: 400px }
	    	#draggable { width: 150px; height: 150px; padding: 0.5em; }
	    	#mapcontrols { width: 100%; margin-bottom: 0.5em;  margin-top: 0.5em; }
	</style>

    <!-- Custom styles for this template -->
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">
    <link href="assets/js/fancybox/jquery.fancybox.css" rel="stylesheet" />
    <script src="https://cdn.firebase.com/js/client/2.2.4/firebase.js"></script>

    <!-- Just for debugging purposes. Don't actually copy this line! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- jQuery and jQuery UI -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

    <!-- Google Maps API integration -->
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBjoWIyA0eUHRCF_G9wzMJ48Hz7T3bfjpg&v=3.exp&sensor=false&libraries=places,drawing,geometry"> </script>

    		<script type="text/javascript">


	  //       $(function() {   $( "#draggable" ).draggable(); });

	 	    function initialize(){
                  
            	    
		            geocoder = new google.maps.Geocoder();
		            address = document.getElementById('address').value;

		            var mapOptions = {
			    		zoom: 20,
			    		disableDefaultUI: true,
			    		zoomControl: true,
			    		panControl: true,
			    		mapTypeControl: true,
			    		scaleControl: true,
			    		streetViewControl: true,
			    		overviewMapControl: true,
			    		mapTypeId:google.maps.MapTypeId.SATELLITE,
			    		tilt: 0
			    	};
		           
			    	geocoder.geocode( { 'address': address}, function(results, status) {
		                if (status == google.maps.GeocoderStatus.OK) {
		                 map.setCenter(results[0].geometry.location);
		                 x = results[0].geometry.location;

		                 }
		             }); 
			    
		         
			        var map = new google.maps.Map(document.getElementById("mapDiv"), mapOptions);


				    var mapOptions45 = {
				    		zoom: 20,
				    		disableDefaultUI: true,
				    		mapTypeId:google.maps.MapTypeId.SATELLITE,
				    		tilt: 45
				    };
		           

			    	geocoder.geocode( { 'address': address}, function(results, status) {
		                if (status == google.maps.GeocoderStatus.OK) {
		                 map45.setCenter(results[0].geometry.location);
		                 x = results[0].geometry.location;

		                 }
		            }); 
			    
		         
			    	var map45 = new google.maps.Map(document.getElementById("mapDiv45"), mapOptions45);
			    
			     
				    addButtons(map);
			        drawEditablePolygon(map);			    

	    	}

	     
		 function addButtons(map){

		    	document.getElementById('btnTerrain').addEventListener('click', function(){
		    	map.setMapTypeId(google.maps.MapTypeId.TERRAIN);
		    	});

			    document.getElementById('btnRoadmap').addEventListener('click', function(){
			    map.setMapTypeId(google.maps.MapTypeId.ROADMAP);
			    });

			    document.getElementById('btnSatellite').addEventListener('click', function(){
			    map.setMapTypeId(google.maps.MapTypeId.SATELLITE);
			    });


			    document.getElementById('btnHybrid').addEventListener('click', function(){
			    map.setMapTypeId(google.maps.MapTypeId.HYBRID);
			    });

	    	}
	   

	    function drawEditablePolygon(map) {

            	geocoder = new google.maps.Geocoder();
            	address = document.getElementById('address').value;
	    		geocoder.geocode( { 'address': address}, function(results, status) {
                		if (status == google.maps.GeocoderStatus.OK) {

                 				 map.setCenter(results[0].geometry.location);

				                 lat = results[0].geometry.location.k;
				                 lon = results[0].geometry.location.D;
				                 lat_adjacent = Number(results[0].geometry.location.k) + 0.0001;
				                 lon_adjacent = Number(results[0].geometry.location.D) + 0.0001;

				                 console.log("LAT: " + lat + " | ADJACENT LAT: " + lat_adjacent + " LON: " + lon + " | ADJACENT LON: " + lon_adjacent);

								 var natureCoords = [
				                 new google.maps.LatLng(lat, lon_adjacent),   
				                 new google.maps.LatLng(lat, lon),   
				                 new google.maps.LatLng(lat_adjacent, lon),   
				                 new google.maps.LatLng(lat_adjacent, lon_adjacent) ];

						         var natureArea = new google.maps.Polygon({
						         path: natureCoords,
						         strokeColor: "#FFFFFF",
						         strokeOpacity: 0.8,
						         strokeWeight: 2,
						         fillColor: "#00FF00",
						         fillOpacity: 0.6,
						         editable: true,
						         draggable: true
						         });

		         				natureArea.setMap(map);

					            document.getElementById('calculate').addEventListener('click', function(){

							            surface_area =  Number(google.maps.geometry.spherical.computeArea(natureArea.getPath()));

							            size_premimum = Number(surface_area * 0.15);
							            size_standard = Number(surface_area * 0.10);

								        document.getElementById('results').innerHTML = "Surface Area = " + surface_area.toFixed(0) + " sq meter <br/>";
								        document.getElementById('results').innerHTML += "Size by using premium solar panels (SunPower) = " + size_premimum.toFixed(2) + " kW <br/>";
								        document.getElementById('results').innerHTML += "Size by using standard solar panels = " + size_standard.toFixed(2) + " kW <br/>";
					                    var tilt = parseInt(document.getElementById('tilt').value);
					                    var azimuth = parseInt(document.getElementById('azimuth').value); 
                   						var requestUrl="http://developer.nrel.gov/api/pvwatts/v5.json?api_key=j3q56adLB5f8m98CwVYUkC95NC8h1GMK6mcSt9OP&lat=" + lat + "&lon=" + lon + "&timeframe=monthly&system_capacity=" + size_premimum + "&module_type=1&losses=14&array_type=1&tilt=" + tilt + "&azimuth=" + azimuth + "&callback=?";
										
										$.getJSON(requestUrl, { }, function (data){ 
											console.log(data.outputs);
				                            energyGenerated = data.outputs.ac_annual;
				                            lease = energyGenerated * 0.2 * 0.15;
				                            document.getElementById('results').innerHTML += "Estimated Electricity Production = " + energyGenerated + " kWh <br/>";
				                            document.getElementById('results').innerHTML += "<strong> Lease =  $" + lease + " per year<strong> <br/>";
                            			});

                   						var requestUtilityCompanies ="http://developer.nrel.gov/api/census_rate/v3.json?api_key=j3q56adLB5f8m98CwVYUkC95NC8h1GMK6mcSt9OP&region=block&id=101&lat=" + lat + "&lon=" + lon; 
  
                    					$.getJSON(requestUtilityCompanies, { }, function (data){
                    						document.getElementById('results').innerHTML += "<strong>Utility Companies in Your Area: </strong>";
                    						var i=0;
                    						while(data.outputs.utility_info[i]){
                  							console.log(data.outputs.utility_info[i].utility_name);
        									document.getElementById('results').innerHTML += data.outputs.utility_info[i].utility_name + "<br />";
        									i++;
        									}
      									});

                           		}); 
		                 
		                 } /* END OF IF CONDITION */

		             }); /* END OF GEOCODER OPENING */
        
         	}



       
	    google.maps.event.addDomListener(window, "load", initialize);
	    



         $(document).ready(function() {  
	     $('#update_address').click( function(){
	        $('#results').empty();
    		initialize();
           
	    }); 

	    });
	     

	    </script>


  </head>

  <body data-spy="scroll" data-offset="0" data-target="#theMenu">
		
	<!-- Menu -->
	<nav class="menu" id="theMenu">
		<div class="menu-wrap">
			<h1 class="logo"><a href="index.html#home">ROOFLY</a></h1>
			<i class="fa fa-times menu-close"></i>
			<a href="index.html" class="smoothScroll">Home</a>
			<a href="listing.html" class="smoothScroll">Listing</a>

			<a href="#" class="smoothScroll"> 
<form>
			 <div class="form-group">
    		<input type="email" class="form-control" id="name" placeholder="Enter name">
  			</div>
  			 <div class="form-group">
    		<input type="email" class="form-control" id="email" placeholder="Enter email">
  			</div>
			<div class="form-group">
    		<input type="text" class="form-control" id="phoneNumber" placeholder="Enter phone">
  			</div>
</form>
<button  class="btn btn-primary" id="calculateValue">Calculate Value</button></a>
			<a href="#"><i class="fa fa-facebook"></i></a>
			<a href="#"><i class="fa fa-twitter"></i></a>
			<a href="#"><i class="fa fa-dribbble"></i></a>
			<a href="#"><i class="fa fa-envelope"></i></a>
		



		</div>
		
		<!-- Menu button -->
		<div id="menuToggle"><i class="fa fa-bars"></i></div>
	</nav>

	<section id="home" name="home">
		
	</section>
	<div id="headerwrap">
               
		<div class="container">
		 <h2> Start earning cash on your roof now. </h2>
		 <p id="learn"> Learn more </p>    
		        <div style="display: none;">
			    <h3> 1- Use the map below to select which part of your roof to lease to power companies. </h3>
			    <h3> 2- Get an instant estimate of how much you will earn. </h3>
			    <h3> 3- List your space.  </h3>
			    </div>
			<div class="row">
			   

				<div class="col-md-12 col-md-offset-0">

    <div id="mapcontrols">			
    <div style="float:left;">	
    MAP CONTROLS: 
    <button id="btnTerrain"> terrain </button> 
	<button id="btnRoadmap"> Roadmap </button><
	<button id="btnSatellite"> Satellite </button>
	<button id="btnHybrid"> Hybrid </button> 
	</div>
	<input id="address" size="60" value="56, centre street, mountain view, California" /> 
	<button id="update_address" class="btn btn-secondary"> Update Address </button> 

	<br/>
	        Type of your roof: 
	        <select id="tilt">
				<option value="0"> Flat</option>
				<option value="30"> Pitched </option>
	        </select>

	Orientation of building: <input id="azimuth" size="4" value="180" /> <br /> <br />
	<button id="calculate" class="btn btn-primary"> Calculate </button> <br /> <br />
    <div id="results"></div>
    <div id="mapDiv"></div>
    <div id="mapDiv45"></div>
    <div  id="draggable" class="ui-widget-content"><img src="compass.png"></div>
    </div>


				</div>
			</div><! --/row -->
		</div><! --/container -->
	</div><! --/headerwrap -->
	
	
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script src="assets/js/classie.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/smoothscroll.js"></script>
	<script src="assets/js/jquery.stellar.min.js"></script>
	<script src="assets/js/fancybox/jquery.fancybox.js"></script>    
	<script src="assets/js/main.js"></script>
		<script>
		$(function(){
			$.stellar({
				horizontalScrolling: false,
				verticalOffset: 40
			});
		});
		</script>

		<script type="text/javascript">
      $(function() {
        //    fancybox
          jQuery(".fancybox").fancybox();
          // firebase 
          var fb = new Firebase("https://solarpanel.firebaseio.com");


          $("#calculateValue").click(function(){
          		alert("Calculating all the things and storing in FireBase!");

          		/* WRITE YOUR CODE HERE TO CALCULATE THINGS */
          		var name =  $("#name").val(); 
          		var email =  $("#email").val(); 
          		var phoneNumber =  $("#phoneNumber").val(); 



          		/* get all the variables */ 

    /*
          		fb.push({ 	name: name,
							email: email,
							phoneNumber: phoneNumber,
							address: "4",
							roofArea: "5", 
							leasingPrice: "6",
							energyGenerated: "7", 
							localElectricityComp: "8"
 				}); */

          })
      });


	   </script>

  </body>
</html>
